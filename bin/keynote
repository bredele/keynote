#!/usr/bin/env node

var fs = require('fs'),
		read = fs.readFileSync,
		write = fs.writeFile,
		resolve = require('path').resolve,
		program = require('commander'),
		ncp = require('ncp'),
		mkdir = require('mkdirp').sync,
		walk = require('./walk'),
		template = require('./template'),
		serve = require('./serve');


/**
 * Usage.
 */

program
  .version(require('../package.json').version)
  .option('-o, --output', 'create keynote directory with output')  
  .option('-w, --watch', 'watch the input file for changes')


/**
 * Examples.
 */

program.on('--help', function () {
  console.log('  Examples:');
});


/**
 * Parse.
 */

program.parse(process.argv);


// path

var path = resolve('.');
var output = program.output || './keynote';


//create output directory

mkdir(output);


//update output directory

ncp(__dirname + '/basic', output, function(err) {
	if(err) throw err;
	var file = read(output + '/index.html', {
		encoding: 'utf-8'
	});
	write(output + '/index.html', template(file, {
		title: 'keynote',
		keynote: walk(path)
	}), function() {
		if(err) throw err;
	});
});

serve(output);